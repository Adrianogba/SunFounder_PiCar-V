{% extends "base.html" %}
{% load static %}

{% block left_button %}
<button class="mui-btn mui-btn--flat mui-btn--small" form="back" style="background-color:#000000;background-color:rgba(0,0,0,0)"><img src="{% static "back_unpressed.png" %}"></button>
{% endblock %}

{% block right_button %}
<button class="mui-btn mui-btn--flat mui-btn--small" form="settings" style="background-color:#000000;background-color:rgba(0,0,0,0)"><img src="{% static "settings_unpressed.png" %}"></button>
{% endblock %}

{% block content %}
  <script type="text/javascript">
    run_action('bwready');
    run_action('fwready');
    run_action('camready');
    var allowed = true;

    function run_action(value){
      var xmlHttp  = new XMLHttpRequest();
      var protocol  = window.location.protocol;
      var host      = window.location.host;
      var pathname  = window.location.pathname;
      url = protocol + "//" + host + pathname + "?action" + "=" + value;
      //document.getElementById("debug").innerHTML=url;
      xmlHttp.open( "GET", url, false );
      xmlHttp.send( null );
      return xmlHttp.responseText;
    }
    function set_speed(value){
      var xmlHttp  = new XMLHttpRequest();
      var protocol  = window.location.protocol;
      var host      = window.location.host;
      var pathname  = window.location.pathname;
      url = protocol + "//" + host + pathname + "?speed" + "=" + value;
      //document.getElementById("debug").innerHTML=url;
      xmlHttp.open( "GET", url, false );
      xmlHttp.send( null );
      return xmlHttp.responseText;
    }
    function keydown_event(key){
      if (event.repeat != undefined) {
        allowed = !event.repeat;
      }
      if (!allowed) return;
      allowed = false;
      if (key == 0){
        var x;
        if(window.event) { // IE8 以及更早版本
          x=event.keyCode;
        }
        else if(event.which) {// IE9/Firefox/Chrome/Opera/Safari
          x=event.which;
        }
        var keychar=String.fromCharCode(x);
      }
      else{
        keychar = key
      }
      switch(keychar){
        case 'W':
          run_action('forward')
          break;
        case 'S':
          run_action('backward')
          break;
        case 'A':
          run_action('fwleft')
          break;
        case 'D':
          run_action('fwright')
          break;
        case '&':
          run_action('camup')
          break;
        case '(':
          run_action('camdown')
          break;
        case "'":
          run_action('camright')
          break;
        case '%':
          run_action('camleft')
          break;
        case '1':
          set_speed('40')
          break;
        case '2':
          set_speed('55')
          break;
        case '3':
          set_speed('70')
          break;
        case "4":
          set_speed('85')
          break;
        case '5':
          set_speed('100')
          break;
      }
    }
    function keyup_event(key){
      allowed = true;
      if (key == 0){
        var x;
        if(window.event) { // IE8 以及更早版本
          x=event.keyCode;
        }
        else if(event.which) {// IE9/Firefox/Chrome/Opera/Safari
          x=event.which;
        }
        var keychar=String.fromCharCode(x);
      }
      else{
        keychar = key
      }
      switch(keychar){
        case 'W':
          run_action('stop')
          break;
        case 'S':
          run_action('stop')
          break;
        case 'A':
          run_action('fwstraight')
          break;
        case 'D':
          run_action('fwstraight')
          break;
        case '&':
          run_action('camready')
          break;
        case '(':
          run_action('camready')
          break;
        case "'":
          run_action('camready')
          break;
        case '%':
          run_action('camready')
          break;
      }
    }
    function forward_left(){
      run_action('forward')
      run_action('fwleft')
    }
    function forward_right(){
      run_action('forward')
      run_action('fwright')
    }
    function backward_left(){
      run_action('backward')
      run_action('fwleft')
    }
    function backward_right(){
      run_action('backward')
      run_action('fwright')
    }
    function camup_left(){
      run_action('camup')
      run_action('camleft')
    }
    function camup_right(){
      run_action('camup')
      run_action('camright')
    }
    function camdown_left(){
      run_action('camdown')
      run_action('camleft')
    }
    function camdown_right(){
      run_action('camdown')
      run_action('camright')
    }
    function stop(){
      run_action('stop')
      run_action('fwstraight')
    }
  </script>
  <div class="mui-container-fluid-height mui-container-fluid-line-height">
    <div class="mui-row", align="center">
      <img class="mui--z2", src="http://{{ host }}:8080/?run_action=stream" />
    </div>
    <div class="mui-row">
      <div class="mui-col-xs-3 mui-col-sm-3", align="right">
        <button class="mui-btn mui--text-subhead" disabled>Speed Level:</button>
      </div>
      <div class="mui-col-xs-1 mui-col-sm-1", align="center">
        <button class="mui-btn mui-btn--primary" onmousedown="set_speed('40')">1</button>
      </div>
      <div class="mui-col-xs-1 mui-col-sm-1", align="center">
        <button class="mui-btn mui-btn--primary" onmousedown="set_speed('55')">2</button>
      </div>
      <div class="mui-col-xs-1 mui-col-sm-1", align="center">
        <button class="mui-btn mui-btn--primary" onmousedown="set_speed('70')">3</button>
      </div>
      <div class="mui-col-xs-1 mui-col-sm-1", align="center">
        <button class="mui-btn mui-btn--primary" onmousedown="set_speed('85')">4</button>
      </div>
      <div class="mui-col-xs-1 mui-col-sm-1", align="center">
        <button class="mui-btn mui-btn--primary" onmousedown="set_speed('100')">5</button>
      </div>
    </div>
    <!-- Control Panel-->
    <!--Forward, Camera up button  ◤◥-->
    <div class="mui-row">
      <div class="mui-col-xs-2 mui-col-sm-2", align="right">
        <button class="mui-btn mui-btn--primary" onmousedown="forward_left()" onmouseup="run_action('stop')" ontouchstart="forward_left()" ontouchend="run_action('stop')">◤</button>
      </div>
      <div class="mui-col-xs-2 mui-col-sm-2", align="center">
        <button class="mui-btn mui-btn--primary" onmousedown="run_action('forward')" onmouseup="run_action('stop')" ontouchstart="run_action('forward')" ontouchend="run_action('stop')">▲</button>
      </div>
      <div class="mui-col-xs-2 mui-col-sm-2", align="left">
        <button class="mui-btn mui-btn--primary" onmousedown="forward_left()" onmouseup="run_action('stop')" ontouchstart="forward_left()" ontouchend="run_action('stop')">◥</button>
      </div>
      <div class="mui-col-xs-2 mui-col-sm-2", align="right">
        <button class="mui-btn mui-btn--primary" onmousedown="camup_left()" ontouchstart="camup_left()">◸</button>
      </div>
      <div class="mui-col-xs-2 mui-col-sm-2", align="center">
        <button class="mui-btn mui-btn--primary" onmousedown="run_action('camup')" ontouchstart="run_action('camup')">△</button>
      </div>
      <div class="mui-col-xs-2 mui-col-sm-2", align="left">
        <button class="mui-btn mui-btn--primary" onmousedown="camup_right()" ontouchstart="camup_right()">◹</button>
      </div>
    </div>-->
    <!--Camera Left, Right button-->
      <div class="mui-col-xs-2 mui-col-sm-2 mui-col-sm-offset-6 mui-col-xs-offset-6", align="right">
        <button class="mui-btn mui-btn--primary" onmousedown="run_action('camleft')" ontouchstart="run_action('camleft')">◁</button>
      </div>
      <div class="mui-col-xs-2 mui-col-sm-2 mui-col-sm-offset-6 mui-col-xs-offset-6", align="right">
        <button class="mui-btn mui-btn--primary" onmousedown="run_action('camready')" ontouchstart="run_action('camready')">□</button>
      </div>
      <div class="mui-col-xs-2 mui-col-sm-2 mui-col-sm-offset-2 mui-col-xs-offset-2", align="left">
        <button class="mui-btn mui-btn--primary" onmousedown="run_action('camright')" ontouchstart="run_action('camright')">▷</button>
      </div>
    </div>
    <!--Backward button-->
    <div class="mui-row", align="center">
      <div class="mui-col-xs-2 mui-col-sm-2 mui-col-sm-offset-2 mui-col-xs-offset-2", align="center">
          <button class="mui-btn mui-btn--primary" onmousedown="backward_left()" onmouseup="run_action('stop')" ontouchstart="backward_left()" ontouchend="run_action('stop')">◣</button>
      </div>
      <div class="mui-col-xs-2 mui-col-sm-2 mui-col-sm-offset-2 mui-col-xs-offset-2", align="center">
          <button class="mui-btn mui-btn--primary" onmousedown="run_action('backward')" onmouseup="run_action('stop')" ontouchstart="run_action('backward')" ontouchend="run_action('stop')">▼</button>
      </div>
      <div class="mui-col-xs-2 mui-col-sm-2 mui-col-sm-offset-2 mui-col-xs-offset-2", align="center">
          <button class="mui-btn mui-btn--primary" onmousedown="backward_right()" onmouseup="run_action('stop')" ontouchstart="backward_right()" ontouchend="run_action('stop')">◢</button>
      </div>
      <div class="mui-col-xs-2 mui-col-sm-2 mui-col-sm-offset-4 mui-col-xs-offset-4", align="center">
          <button class="mui-btn mui-btn--primary" onmousedown="camdown_left()" ontouchstart="camdown_left()">◺</button>
      </div>
      <div class="mui-col-xs-2 mui-col-sm-2 mui-col-sm-offset-4 mui-col-xs-offset-4", align="center">
          <button class="mui-btn mui-btn--primary" onmousedown="run_action('camdown')" ontouchstart="run_action('camdown')">▽</button>
      </div>
      <div class="mui-col-xs-2 mui-col-sm-2 mui-col-sm-offset-4 mui-col-xs-offset-4", align="center">
          <button class="mui-btn mui-btn--primary" onmousedown="camdown_right()" ontouchstart="camdown_right()">◿</button>
      </div>
    </div>
  </div>
<!--Debug: http://{{ debug }}:8080/?run_action=stream-->
</body>
{% endblock %}